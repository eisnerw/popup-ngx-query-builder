<div class="query-input">
  <button pButton icon="pi pi-search" class="search-btn" (click)="clickSearch()"></button>

  <div class="text" *ngIf="!editing" (click)="editing = true">
    <span [ngClass]="{'placeholder': !query}">{{ query || placeholder }}</span>
  </div>
  <input pInputText *ngIf="editing" [(ngModel)]="query" (keyup.enter)="acceptEdit()" />

  <div class="btn-group" *ngIf="editing">
    <button pButton icon="pi pi-times" (click)="cancelEdit()"></button>
    <button pButton icon="pi pi-check" (click)="acceptEdit()"></button>
  </div>
</div>

<p-dialog [(visible)]="showBuilder" [modal]="true" header="Query Builder" [style]="{width: '50vw'}">
  <div class="query-builder">
    <div class="condition-row">
      <label>Condition: </label>
      <p-dropdown 
        [(ngModel)]="builderQuery.condition" 
        [options]="[{value: 'and', name: 'AND'}, {value: 'or', name: 'OR'}]"
        optionValue="value"
        optionLabel="name"
        placeholder="Select condition">
      </p-dropdown>
    </div>

    <div class="rules-section">
      <h4>Rules:</h4>
      <div *ngFor="let rule of builderQuery.rules; let i = index" class="rule-row">
        <p-dropdown 
          [(ngModel)]="rule.field" 
          [options]="queryBuilderConfig.fields"
          optionValue="value"
          optionLabel="name"
          placeholder="Select field">
        </p-dropdown>
        
        <p-dropdown 
          [(ngModel)]="rule.operator" 
          [options]="operators"
          optionValue="value"
          optionLabel="name"
          placeholder="Select operator">
        </p-dropdown>
        
        <input pInputText [(ngModel)]="rule.value" placeholder="Enter value" />
        
        <button pButton icon="pi pi-trash" (click)="removeRule(i)" class="p-button-danger"></button>
      </div>
      
      <button pButton icon="pi pi-plus" label="Add Rule" (click)="addRule()" class="p-button-outlined"></button>
    </div>
  </div>
  
  <ng-template pTemplate="footer">
    <button pButton label="Cancel" (click)="cancelQuery()" class="p-button-secondary"></button>
    <button pButton label="Apply" (click)="applyQuery()" class="p-button-primary"></button>
  </ng-template>
</p-dialog>
