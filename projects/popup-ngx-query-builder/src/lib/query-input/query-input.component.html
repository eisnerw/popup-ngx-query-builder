<div class="query-input">
  <button pButton icon="pi pi-search" class="search-btn" (click)="clickSearch()"></button>

  <div class="text" *ngIf="!editing" (click)="editing = true">
    <span [ngClass]="{'placeholder': !query}">{{ query || placeholder }}</span>
  </div>
  <input pInputText *ngIf="editing" [(ngModel)]="query" (keyup.enter)="acceptEdit()" />

  <div class="btn-group" *ngIf="editing">
    <button pButton icon="pi pi-times" (click)="cancelEdit()"></button>
    <button pButton icon="pi pi-check" (click)="acceptEdit()"></button>
  </div>
</div>

<p-dialog 
  [(visible)]="showBuilder" 
  [modal]="true" 
  [closable]="true"
  [draggable]="true"
  [resizable]="true"
  [maximizable]="true"
  header="Query Builder" 
  [style]="{width: '800px', height: '600px', minWidth: '600px', minHeight: '400px'}"
  [contentStyle]="{height: 'calc(100% - 120px)', overflow: 'auto', padding: '0'}"
  styleClass="query-builder-dialog"
  [baseZIndex]="10000">
  
  <div class="query-builder-content">
    <div class="condition-row">
      <label>Condition: </label>
      <p-dropdown 
        [(ngModel)]="builderQuery.condition" 
        [options]="[{value: 'and', name: 'AND'}, {value: 'or', name: 'OR'}]"
        optionValue="value"
        optionLabel="name"
        placeholder="Select condition">
      </p-dropdown>
    </div>

    <div class="rules-section">
      <h4>Rules:</h4>
      <div class="rules-scrollable">
        <div *ngFor="let rule of builderQuery.rules; let i = index" class="rule-row">
          <p-dropdown 
            [(ngModel)]="rule.field" 
            [options]="queryBuilderConfig.fields"
            optionValue="value"
            optionLabel="name"
            placeholder="Select field">
          </p-dropdown>
          
          <p-dropdown 
            [(ngModel)]="rule.operator" 
            [options]="operators"
            optionValue="value"
            optionLabel="name"
            placeholder="Select operator">
          </p-dropdown>
          
          <input pInputText [(ngModel)]="rule.value" placeholder="Enter value" />
          
          <button pButton icon="pi pi-trash" (click)="removeRule(i)" class="p-button-danger p-button-sm"></button>
        </div>
        
        <button pButton icon="pi pi-plus" label="Add Rule" (click)="addRule()" class="p-button-outlined add-rule-btn"></button>
      </div>
    </div>
  </div>
  
  <ng-template pTemplate="footer">
    <div class="dialog-footer">
      <button pButton label="Cancel" (click)="cancelQuery()" class="p-button-secondary"></button>
      <button pButton label="Apply" (click)="applyQuery()" class="p-button-primary"></button>
    </div>
  </ng-template>
</p-dialog>
